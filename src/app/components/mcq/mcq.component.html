<div class="row g-4">

  <div class="col-md-4">
    <form class="border rounded-3 p-4 bg-light" (ngSubmit)="mcqGenerate(mcqForm)" #mcqForm="ngForm">
      <h2 class="mb-4">Generate MCQs</h2>

      <div class="mb-3">
        <label for="topic" class="form-label">Topic</label>
        <input id="topic" name="topic" type="text" required [(ngModel)]="topicName" class="form-control"
          placeholder="Enter topic" #topicInput="ngModel" />
        <div *ngIf="topicInput.invalid && topicInput.touched" class="text-danger mt-1">
          Topic is required.
        </div>
      </div>

      <div class="mb-3">
        <label for="difficulty" class="form-label">Difficulty</label>
        <select id="difficulty" name="difficulty" class="form-select" [(ngModel)]="selectedDifficulty" required
          #difficultyInput="ngModel">
          <option value="" disabled selected>Choose difficulty</option>
          <option value="easy">Easy</option>
          <option value="medium">Medium</option>
          <option value="hard">Hard</option>
        </select>
        <div *ngIf="difficultyInput.invalid && difficultyInput.touched" class="text-danger mt-1">
          Difficulty is required.
        </div>
      </div>

      <div class="mb-3">
        <label for="numQuestions" class="form-label">Number of Questions</label>
        <input id="numQuestions" name="numQuestions" type="number" [(ngModel)]="numberOfQuestions" min="1" max="10"
          required class="form-control" placeholder="e.g. 4" #questionInput="ngModel" />
        <div *ngIf="questionInput.invalid && questionInput.touched" class="text-danger mt-1">
          Please enter a valid number (1â€“10).
        </div>
      </div>

      <button type="submit" class="btn btn-primary w-100" [disabled]="mcqForm.invalid">Generate</button>
    </form>
  </div>

  <!-- Right Side: Questions and Spinner -->
  <div class="col-md-8">
    <div class="border rounded-3 p-4 bg-white h-100 d-flex justify-content-center align-items-center" *ngIf="isLoading"
      style="min-height: 300px;">
      <div class="text-center">
        <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
          <span class="visually-hidden">Loading...</span>
        </div>
        <p class="mt-3">Generating questions...</p>
      </div>
    </div>

    <div>

      <h2 class="mb-4">Questions</h2>
      <div *ngFor="let question of mcqData; let i = index" class="mb-4">
        <div class="fw-medium mb-2">
          {{i + 1}}. {{question.question}}
        </div>
        <div *ngFor="let key of (question.options | keyvalue)" class="form-check mb-1">
          <input class="form-check-input" type="radio" [name]="'question' + i" [value]="key.key"
            [id]="'q' + i + 'o' + key.key" (click)="selectAnswer(i, key.key)" [ngClass]="{
      'border-success': selectedIndex === i && key.key === question.answer,
      'border-danger': selectedIndex === i && selectedAnswer === key.key && key.key !== question.answer
    }">
          <label class="form-check-label" [for]="'q' + i + 'o' + key.key" [ngClass]="{
      'fw-bold text-success': selectedIndex === i && key.key === question.answer,
      'text-danger': selectedIndex === i && selectedAnswer === key.key && key.key !== question.answer
    }">
            {{key.key}}. {{key.value}}
          </label>
        </div>


        <div class="mt-2 text-success fw-semibold">
          @if (selectedIndex === i && selectedAnswer !== question.answer) {
          Correct Answer: {{ question.answer }}
          }
        </div>

      </div>
    </div>
      @if(this.mcqData.length > 0) {
          <button class="btn btn-success mb-4 d-block mx-auto" (click)="downloadMCQ()" >Export to CSV</button>
      }
  </div>


</div>